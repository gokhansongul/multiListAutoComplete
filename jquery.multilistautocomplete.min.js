(function(g){g.fn.multiListAutoComplete=function(h){if(!h||h.proxy&&"function"!==typeof h.proxy||!h.appendTo)throw"Error!";var j=g(this),e=null,n=[],l=0,p=0,s=function(){e.find("ul.autocomplete").remove()},t=function(){e.show(b.delayTime,b.onOpen);p=setTimeout(function(){k()},b.visibleTime)},k=function(){e.hide(b.delayTime,b.onClose)},m=function(){return e.find("ul.autocomplete").find("li").filter(".state-hover")},q=function(a){var c=null,c=a&&a.length?a:m();return c.parents("ul.autocomplete")},r=
    function(a){m().removeClass("state-hover");a.addClass("state-hover")},u=function(a){if(!a||!a.length)a=q();var c=a.next();c.length||(c=a.parent().find("ul.autocomplete").first());return c},v=function(a){if(!a||!a.length)a=q();var c=a.prev();c.length||(c=a.parent().find("ul.autocomplete").last());return c},x=function(a){e.is(":visible")||t();a.length?(a=a.next(),a.length||(a=u().find("li").first())):a=e.find("ul.autocomplete").find("li").first();r(a)},y=function(a){a=a.prev();a.length||(a=v().find("li").last());
    r(a)},w=function(a,c){var b=q(a),d=null,b=d=39==c.keyCode?u(b):v(b),d=a.index(),d=b.find("li").eq(d);if(!d||!d.length)d=b.find("li").eq(0);r(d)},z=function(a){var c=a.find("a").data("value");c&&(j.val(c).focus(),b.onSelect&&b.onSelect(a.find("a")),k())},b={delayTime:500,visibleTime:1E4,minLength:3,itemPerList:10,eventType:"keyup",appendTo:null,label:null,value:null,proxy:null,renderItem:function(a){var c=g("<li></li>").addClass("autocomplete-search-item"),f=g("<a></a>").appendTo(c);f.data("value",
    a[b.value]).data("label",a[b.label]).html(a[b.label]).bind("click",function(){j.val(a[b.value]).focus();b.onSelect&&b.onSelect(f)});return c},onSelect:function(){},onFocus:function(){},onOpen:function(){},onClose:function(){}};g.extend(b,h);e=g(b.appendTo);j.bind(b.eventType,function(a){for(var c=0;c<n.length;c++)clearTimeout(n[c]);var c=g.trim(this.value),f=a.keyCode,d=b.minLength;"keydown"==b.eventType.toLowerCase()&&(d-=2,8==a.keyCode&&(d=b.minLength+1));if(c&&c.length>=d){if(37<=f&&40>=f||13==
    f){clearTimeout(p);c=a.keyCode;f={38:y,40:x,39:w,37:w,13:z};if(!((37==c||39==c)&&1==l)&&f[c])j.focus(),f[c](m(),a),b.onFocus&&b.onFocus(m()),p=setTimeout(function(){k()},b.visibleTime);return!1}a=setTimeout(function(){var a=b.proxy(j.val());if(a&&a.list){s();for(var c in a.list){l++;var d=a.list[c];if(d&&g.isArray(d))for(var f=g("<ul></ul>").addClass("autocomplete").addClass("list-"+l).appendTo(b.appendTo),e=0;e<d.length;e++)f.append(b.renderItem(d[e]))}t()}l=0},b.delayTime);n.push(a)}else k(),s()}).bind("blur",
    k)}})(jQuery);