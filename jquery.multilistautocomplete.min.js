(function(g){g.fn.multiListAutoComplete=function(h){if(!h||h.proxy&&"function"!==typeof h.proxy||!h.appendTo)throw"Error!";var m=g(this),f=null,q=[],k=0,r=0,x=function(){b.proxy(m.val(),function(a){if(a&&a.list){f.find("ul.autocomplete").remove();for(var c in a.list){k++;var e=a.list[c];if(e&&g.isArray(e))for(var d=g("<ul></ul>").addClass("autocomplete").addClass("list-"+k).appendTo(b.appendTo),l=0;l<e.length;l++)d.append(b.renderItem(e[l],b))}1<k?f.addClass("multipleList"):f.removeClass("multipleList");
    u()}})},u=function(){b.onOpen&&b.onOpen(k);f.fadeIn(b.delayTime);b.visibleTime&&(r=setTimeout(function(){n()},b.visibleTime))},n=function(){f.fadeOut(b.delayTime,b.onClose)},y=function(){for(var a=0;a<q.length;a++)clearTimeout(q[a])},p=function(){return f.find("ul.autocomplete").find("li").filter(".state-hover")},s=function(a){var c=null,c=a&&a.length?a:p();return c.parents("ul.autocomplete")},t=function(a){p().removeClass("state-hover");a.addClass("state-hover")},v=function(a){a&&a.length||(a=s());
    var c=a.next("ul.autocomplete");c.length||(c=a.parent().find("ul.autocomplete").first());return c},w=function(a){a&&a.length||(a=s());var c=a.prev("ul.autocomplete");c.length||(c=a.parent().find("ul.autocomplete").last());return c},z=function(a){f.is(":visible")||u();a.length?(a=a.next(),a.length||(a=v().find("li").first())):a=f.find("ul.autocomplete").find("li").first();t(a)},A=function(a){a=a.prev();a.length||(a=w().find("li").last());t(a)},B=function(a,c){if(a&&a.length&&!(2>k)){var b=s(a),d=null,
    b=d=39==c.keyCode?v(b):w(b),d=a.index();(d=b.find("li").eq(d))&&d.length||(d=b.find("li").eq(0));t(d)}},C=function(a){b.visibleTime&&clearTimeout(r);var c={38:A,40:z};1<k&&(a.preventDefault(),c["39"]=c["37"]=B);var e=a.keyCode;c[e]&&(m.focus(),c[e](p(),a),b.onFocus&&b.onFocus.call(this,p().find("a")),b.visibleTime&&(r=setTimeout(function(){n()},b.visibleTime)))},b={delayTime:500,visibleTime:0,minLength:3,itemPerList:10,eventType:"keyup",appendTo:null,label:null,value:null,proxy:null,renderItem:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b){var e=g("<li></li>").addClass("autocomplete-search-item"),d=g("<a></a>").appendTo(e);d.data("value",a[b.value]).data("label",a[b.label]).html(a[b.label]).bind("click",function(){m.val(a[b.value]).focus();b.onSelect&&b.onSelect.call(this,d)});return e},onSelect:function(){},onFocus:function(a){var b=a.data("value");setTimeout(function(){b&&m.val(a.data("value")).focus()},100)},onOpen:function(){},onClose:function(){},onEnter:function(){}};g.extend(b,h);f=g(b.appendTo);m.bind(b.eventType,function(a){y();
    var c=!1;this.setAttribute("autocomplete","off");var e=g.trim(this.value),d=a.keyCode,l=e&&e.length;-1!=b.eventType.toLowerCase().indexOf("keydown")&&(8!=a.keyCode?l++:l--);13==d&&b.onEnter&&b.onEnter(e,b);if(l>=b.minLength){37<=d&&40>=d&&(C(a),c=!0);if(!c)var h=setTimeout(function(){x();k=0},b.delayTime);q.push(h)}else n(),f.find("ul.autocomplete").remove()}).bind("blur",n)}})(jQuery);
