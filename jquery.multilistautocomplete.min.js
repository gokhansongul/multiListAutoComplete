(function(h){h.fn.multiListAutoComplete=function(g){if(!g||g.proxy&&"function"!==typeof g.proxy||!g.appendTo)throw"Error!";var k=h(this),e=null,n=[],j=0,l=0,r=function(){b.onOpen&&b.onOpen(j);e.fadeIn(b.delayTime);b.visibleTime&&(l=setTimeout(function(){m()},b.visibleTime))},m=function(){e.fadeOut(b.delayTime,b.onClose)},f=function(){return e.find("ul.autocomplete").find("li").filter(".state-hover")},p=function(a){var c=null,c=a&&a.length?a:f();return c.parents("ul.autocomplete")},q=function(a){f().removeClass("state-hover");
    a.addClass("state-hover")},s=function(a){if(!a||!a.length)a=p();var c=a.next("ul.autocomplete");c.length||(c=a.parent().find("ul.autocomplete").first());return c},t=function(a){if(!a||!a.length)a=p();var c=a.prev("ul.autocomplete");c.length||(c=a.parent().find("ul.autocomplete").last());return c},v=function(a){e.is(":visible")||r();a.length?(a=a.next(),a.length||(a=s().find("li").first())):a=e.find("ul.autocomplete").find("li").first();q(a)},w=function(a){a=a.prev();a.length||(a=t().find("li").last());
    q(a)},u=function(a,c){if(!(!a||!a.length||2>j)){var b=p(a),d=null,b=d=39==c.keyCode?s(b):t(b),d=a.index(),d=b.find("li").eq(d);if(!d||!d.length)d=b.find("li").eq(0);q(d)}},x=function(a){b.visibleTime&&clearTimeout(l);j&&a.preventDefault();var c=a.keyCode,e={38:w,40:v,39:u,37:u};e[c]&&(k.focus(),e[c](f(),a),b.onFocus&&b.onFocus.call(this,f().find("a")),b.visibleTime&&(l=setTimeout(function(){m()},b.visibleTime)))},b={delayTime:500,visibleTime:0,minLength:3,itemPerList:10,eventType:"keyup",appendTo:null,
    label:null,value:null,proxy:null,renderItem:function(a,b){var e=h("<li></li>").addClass("autocomplete-search-item"),d=h("<a></a>").appendTo(e);d.data("value",a[b.value]).data("label",a[b.label]).html(a[b.label]).bind("click",function(){k.val(a[b.value]).focus();b.onSelect&&b.onSelect.call(this,d)});return e},onSelect:function(){},onFocus:function(a){var b=a.data("value");setTimeout(function(){b&&k.val(a.data("value")).focus()},100)},onOpen:function(){},onClose:function(){},onEnter:function(){}};h.extend(b,
    g);e=h(b.appendTo);k.bind(b.eventType,function(a){for(var c=0;c<n.length;c++)clearTimeout(n[c]);c=!1;this.setAttribute("autocomplete","off");var g=h.trim(this.value),d=a.keyCode,f=g&&g.length;-1!=b.eventType.toLowerCase().indexOf("keydown")&&(8!=a.keyCode?f++:f--);13==d&&b.onEnter&&b.onEnter(g,b);if(f>=b.minLength){37<=d&&40>=d&&(x(a),c=!0);if(!c)var l=setTimeout(function(){b.proxy(k.val(),function(a){if(a&&a.list){e.find("ul.autocomplete").remove();for(var c in a.list){j++;var d=a.list[c];if(d&&
    h.isArray(d))for(var g=h("<ul></ul>").addClass("autocomplete").addClass("list-"+j).appendTo(b.appendTo),f=0;f<d.length;f++)g.append(b.renderItem(d[f],b))}1<j?e.addClass("multipleList"):e.removeClass("multipleList");r()}});j=0},b.delayTime);n.push(l)}else m(),e.find("ul.autocomplete").remove()}).bind("blur",m)}})(jQuery);